"use strict";(self.webpackChunkmeteoscientific=self.webpackChunkmeteoscientific||[]).push([[2996],{3085:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=t(4848),i=t(8453);const o={sidebar_position:5},r="Class C via API",a={id:"tutorial-extras/class_C_kuando_busylight",title:"Class C via API",description:"This guide walks you through using Meteoscientific's API to control a Kuando Busylight via a script. The guide assumes you can follow directions and copy/paste. We will demonstrate how to enqueue a command using the Meteoscientific REST API to control the light.",source:"@site/docs/tutorial-extras/005-class_C_kuando_busylight.md",sourceDirName:"tutorial-extras",slug:"/tutorial-extras/class_C_kuando_busylight",permalink:"/docs/tutorial-extras/class_C_kuando_busylight",draft:!1,unlisted:!1,editUrl:"https://github.com/meteoscientific/website/tree/main/docs/tutorial-extras/005-class_C_kuando_busylight.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Working With Datacake",permalink:"/docs/tutorial-extras/Datacake"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Overview",id:"overview",level:2},{value:"Step 1: Understand the API Call",id:"step-1-understand-the-api-call",level:2},{value:"For my non-nerds:  Let&#39;s do it step by step:",id:"for-my-non-nerds--lets-do-it-step-by-step",level:3},{value:"Step 2: Sample Bash Script to Control the Light",id:"step-2-sample-bash-script-to-control-the-light",level:2},{value:"Step 3: Explanation of the Payload",id:"step-3-explanation-of-the-payload",level:2},{value:"Step 4: Running the Script",id:"step-4-running-the-script",level:2},{value:"Streamdeck &amp; Keyboard Maestro Integration",id:"streamdeck--keyboard-maestro-integration",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"class-c-via-api",children:"Class C via API"})}),"\n",(0,s.jsx)(n.p,{children:"This guide walks you through using Meteoscientific's API to control a Kuando Busylight via a script. The guide assumes you can follow directions and copy/paste. We will demonstrate how to enqueue a command using the Meteoscientific REST API to control the light."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API Access:"})," You need access to Meteoscientific's REST API. Sign up and generate your authorization token via the ",(0,s.jsx)(n.a,{href:"https://console.meteoscientific.com/front/login",children:"Meteoscientific Console"}),".  If you don't know how to generate your authorization token, relax, I'll walk you through it a little later on."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bash Shell:"})," Ensure you have a Bash shell available on your system.  You probably do.  If not, get Google or ChatGPT to help you add it."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Curl:"})," This command-line tool is used to make HTTP requests. If you don\u2019t have it installed, you can install it with your package manager (e.g., ",(0,s.jsx)(n.code,{children:"sudo apt install curl"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:'Unlike the many Class A devices most of us are used to in Helium (trackers, temp checkers, soil moisture, etc) where they listen and only occasionally chirpm, Class C devices are ones that are always "listening" for commands.  That means they\'re usually plugged into the wall (or "into mains" if you want to sound hip) because they need more more power in order to constantly listen.'}),"\n",(0,s.jsx)(n.p,{children:"The upside is you can make 'em dance when you want to, instead of (as with Class A) waiting for them to pop up and transmit, then listen very briefly after the transmit window."}),"\n",(0,s.jsx)(n.p,{children:'You can trigger those "Dance NOW!" commands directly in the MetSci Console to test, but if you want to use a class C device without logging into Console, try using an API (Application Programming Interface).  Now you\'re getting fancy!'}),"\n",(0,s.jsx)(n.p,{children:"Relax, we'll walk you through it."}),"\n",(0,s.jsx)(n.p,{children:"For this tutorial, we'll use a Kuando Busylight, which is a little light that'll light up with any color (even flashing ones!) you want when you tell it to via the Helium LoRaWAN."}),"\n",(0,s.jsx)(n.p,{children:"As it says in the prerequisites, you'll need to be logged into your Console account (and already have your Busylight set up in there)."}),"\n",(0,s.jsx)(n.h2,{id:"step-1-understand-the-api-call",children:"Step 1: Understand the API Call"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"For the nerds:"}),"  We will use the following endpoint to send the command to the Busylight:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /api/devices/{queueItem.devEui}/queue\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This endpoint enqueues a message in the downlink queue for a specific device identified by its ",(0,s.jsx)(n.code,{children:"devEui"}),"."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Headers:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Authorization: Bearer <YOUR_TOKEN>"}),": The token you obtained from the Meteoscientific console."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Accept: application/json"}),": The API expects and returns JSON."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Content-Type: application/json"}),": The payload must be sent as JSON."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Payload Structure:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"queueItem.data"}),": Base64-encoded command data. In this case, it represents the command to set the Busylight to solid red."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fPort"}),": The port the data will be sent through."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"confirmed"}),": Indicates whether the message requires acknowledgment."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"flushQueue"}),": If true, flushes the queue before enqueuing the new message."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"for-my-non-nerds--lets-do-it-step-by-step",children:"For my non-nerds:  Let's do it step by step:"}),"\n",(0,s.jsxs)(n.p,{children:["Start by generating an API key in your ",(0,s.jsx)(n.a,{href:"https://console.meteoscientific.com/front/login",children:"Chirpstack Console"}),".",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"Image description",src:t(9966).A+"",width:"2998",height:"1490"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Save that somewhere secure"}),", you'll need it later!"]}),"\n",(0,s.jsxs)(n.p,{children:["Now, head over to the ",(0,s.jsx)(n.a,{href:"https://console.meteoscientific.com/rest-api/",children:"SwaggerUI API page"}),' and let\'s test this sucker.  First, for the "Authorize" button, up at the top right.']}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(8669).A+"",width:"2932",height:"1412"})}),"\n",(0,s.jsx)(n.p,{children:'Paste in "Bearer" then your API key and hit "Close".'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(3057).A+"",width:"2902",height:"1316"})}),"\n",(0,s.jsxs)(n.p,{children:["Now scroll down to ",(0,s.jsx)(n.a,{href:"https://console.meteoscientific.com/rest-api/#/DeviceService/DeviceService_Enqueue",children:"just above Gateway Service"})," and expand the ",(0,s.jsx)(n.strong,{children:"POST"})," with ",(0,s.jsx)(n.strong,{children:"queue"})," in it, like this:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(3371).A+"",width:"2686",height:"2240"})}),"\n",(0,s.jsxs)(n.p,{children:["Expand that ",(0,s.jsx)(n.strong,{children:"POST"})," and then hit ",(0,s.jsx)(n.strong,{children:"Try it out"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(1307).A+"",width:"2592",height:"1286"})}),"\n",(0,s.jsxs)(n.p,{children:["Fill in your ",(0,s.jsx)(n.strong,{children:"DevEUI"})," and the body:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-{",children:'  "queueItem": {\n    "data": "mQAA/wA=",\n    "fPort": 15,\n    "confirmed": true,\n    "flushQueue": true\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Like this, then hit ",(0,s.jsx)(n.strong,{children:"Execute"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(7166).A+"",width:"2598",height:"1494"})}),"\n",(0,s.jsxs)(n.p,{children:["You should see the ",(0,s.jsx)(n.strong,{children:"response curl"})," and your light should change color to red (",(0,s.jsx)(n.code,{children:"mQAA/wA="}),")"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Image description",src:t(8021).A+"",width:"2602",height:"1446"})}),"\n",(0,s.jsxs)(n.p,{children:["Great, now you've got your curl script and the light works, woohoo!\n",(0,s.jsx)(n.img,{alt:"Image description",src:t(4975).A+"",width:"4032",height:"3024"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"step-2-sample-bash-script-to-control-the-light",children:"Step 2: Sample Bash Script to Control the Light"}),"\n",(0,s.jsx)(n.p,{children:"Now you can use a Bash script to send a command to the Busylight using the Meteoscientific API:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# API endpoint\nURL="https://console.meteoscientific.com/api/devices/[YOUR_DEV_EUI_HERE]/queue"\n\n# Authorization token (replace this with your actual token)\nAUTH_TOKEN="[Your MetSci API key here, without Bearer in front]"\n\n# Payload data (base64-encoded)\nDATA="mQAA/wA="  # This is the base64-encoded payload for solid red\n\n# Making the API request with curl\ncurl -X POST "$URL" \\\n  -H "Accept: application/json" \\\n  -H "Authorization: Bearer $AUTH_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n        "queueItem": {\n          "data": "\'"$DATA"\'",\n          "fPort": 15,\n          "confirmed": true,\n          "flushQueue": true\n        }\n      }\'\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"This script does the following:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API Endpoint:"})," The script points to the device's queue endpoint."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization Token:"})," A JWT token is used for authentication. Replace the placeholder with your actual token."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Payload Data:"})," The ",(0,s.jsx)(n.code,{children:"DATA"})," variable contains a base64-encoded string, which represents the command to set the light to solid red. You can modify this data for other colors or actions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Curl Command:"})," The script uses ",(0,s.jsx)(n.code,{children:"curl"})," to make an HTTP POST request to the API endpoint, passing the necessary headers and payload."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"step-3-explanation-of-the-payload",children:"Step 3: Explanation of the Payload"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"data"}),":"]})," The base64-encoded payload represents the command for the Kuando Busylight. In this example, the value ",(0,s.jsx)(n.code,{children:"mQAA/wA="})," sets the light to solid red.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You can generate different base64 commands depending on the color or pattern you want the Busylight to display."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"fPort"}),":"]})," This indicates the port number. For the Busylight, port ",(0,s.jsx)(n.code,{children:"15"})," is typically used."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"confirmed"}),":"]})," Setting this to ",(0,s.jsx)(n.code,{children:"true"})," means the message requires confirmation from the device."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"flushQueue"}),":"]})," This option ensures that the device queue is cleared before adding this new command, ensuring immediate execution."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"step-4-running-the-script",children:"Step 4: Running the Script"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Save the script to a file, e.g., ",(0,s.jsx)(n.code,{children:"control_busylight.sh"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Make the script executable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x control_busylight.sh\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"In Terminal, run the script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./control_busylight.sh\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If everything is set up correctly, the Kuando Busylight should change to the color or pattern specified by the base64 payload."}),"\n",(0,s.jsx)(n.p,{children:"Now you've got a script that uses the API to make your Busylight turn colors (or off).  Congrats!"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"streamdeck--keyboard-maestro-integration",children:"Streamdeck & Keyboard Maestro Integration"}),"\n",(0,s.jsx)(n.p,{children:"I got a little fancy and set up a script to turn the light red, green, purple, flashing blue, and off using my Streamdeck.  Use the script above as a template, modifying the actual command each time, then save each of those as a separate script, and trigger them with buttons on your Streamdeck.  Easy day.  Here are the colors I used plus a Yellow in case ya need it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1. Solid Red:\nHex: 990000FF00\nBase64: mQAA/wA=\n\n2. Solid Green: \nHex: 000099FF00\nBase64: AABZ/wA=\n\n3. Solid Yellow: \nHex: FF00FF6400\nBase64: /wD/ZAA=\n\n4. Solid Purple:\nHex: FFFF006400\nBase64: //9AZAA=\n\n5. Blue Flashing (1 sec on/off):\nHex: 00FF000A0A\nBase64: AP8ACgo=\n\n6. Off:\nHex: 00000000FF\nBase64: AAAAAP8=\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"Unnecessary.  I don't see how anything could possibly go wrong."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"By following this guide, you can control your Kuando Busylight via the Meteoscientific API. This is useful for creating automation scripts or integrating the light with other tools."}),"\n",(0,s.jsxs)(n.p,{children:["For further reference, consult the ",(0,s.jsx)(n.a,{href:"https://console.meteoscientific.com/rest-api/",children:"Meteoscientific API documentation"})," to explore more API capabilities."]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},3057:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/entering_API_key_in_Chirpstack_Rest_API_to_test_using_Bearer-893e546e01cd2752cd6f6748fa8345c6.png"},1307:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/expand_POST_and_try_it_out-8ee30e96f9eb45c9e579d8e08b670070.png"},7166:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/fill_in_deveui_and_body_then_execute-6feab1414d6bcc1988f7d7cb014acfb9.png"},9966:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/get_API_key_from_Chirpstack-2bbaf15fdcc56f4ded933b97917ace49.png"},4975:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/red_kuando_busylight-cef446e9ad25da994a97c042b5f20f46.JPG"},8021:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/response_curl_and_light_turns_red-29f92f85b87c071ef265338799cd6daf.png"},3371:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/scroll_down_to_POST_queue_just_above_GatewayService-894fcce355859672504ad15f70d4efc3.png"},8669:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/top_of_REST_API_look_for_authorize_button-12364fc8583c368b52103dc696ca6944.png"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);